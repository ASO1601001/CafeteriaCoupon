<ons-page id="first-page">
  <p style="text-align: center;">
    <div id="menu"></div>
  </p>


  <script>
    document.addEventListener("init", function(event) {
    // APIキーの設定とSDK初期化
    var ncmb = new NCMB("c8c2c2c8d06b4c42cf68fbdc6457476a50d459d0b31145ac6e5e002e0122d2e7","8849712cd4e2bd7cec95f092a029bff22fcccdd65d2ca851983e6e0dc9ee51dc");
    var menu = ncmb.DataStore("menutable");
    var reader = new FileReader();

    //
    menu.fetchAll().then(function(results){
      for (var i = 0; i < results.length; i++) {
        document.getElementById("menu").innerHTML+='<img id="image'+i+'" src="" width="100" height="100"/>';
      }
      
    }).catch(function(err){
      console.log(err);
    });
    getMenu(0);
      });

    function getMenu(menuid){
      // APIキーの設定とSDK初期化
      var ncmb = new NCMB("c8c2c2c8d06b4c42cf68fbdc6457476a50d459d0b31145ac6e5e002e0122d2e7","8849712cd4e2bd7cec95f092a029bff22fcccdd65d2ca851983e6e0dc9ee51dc");
      var menu = ncmb.DataStore("menutable");
      var reader = new FileReader();
      menu.fetchAll().then(function(results){
      var dataUrl;
      var fileName;
      var object;
      var image;
      var ist;
      object = results[menuid];
      document.getElementById("menu").innerHTML+=object.name + " " + object.price+ "円<br>";

          
      // ファイル名からファイルを取得
      fileName = object.photo;
      // ダウンロード（データ形式をblobを指定）
      ncmb.File.download(fileName, "blob").then(function(blob) {
        
        // ファイルリーダーにデータを渡す
        reader.readAsDataURL(blob);
        reader.onload = function() {
        dataUrl = reader.result;
        
        ist = new String(menuid);
        image="image"+ist.toString();
        document.getElementById(image).setAttribute('src', dataUrl);
        getMenu(menuid+1);
        };
        }).catch(function(err) {
            console.error(err);
        })
      })
    }
      </script>
    </ons-page>